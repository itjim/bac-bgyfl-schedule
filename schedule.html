<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BGYFL Schedule</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #003366; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #003366; color: white; }
    select, button { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <h1>BGYFL Schedule</h1>

  <label for="weekSelect">Select Week:</label>
  <select id="weekSelect"></select>

  <table id="scheduleTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Home Team</th>
        <th>Away Team</th>
        <th>Field</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = "https://taupe-meringue-d27509.netlify.app/.netlify/functions/proxy?url=" +
      encodeURIComponent("https://slhjx7xcc1.execute-api.us-east-2.amazonaws.com/prod/api");

    async function fetchGames(year = 2025) {
      const res = await fetch(`${API_BASE}/getGames?year=${year}`);
      const data = await res.json();
      return data.games || [];
    }

    function groupByWeek(games) {
      const weeks = {};
      games.forEach(g => {
        if (!weeks[g.week]) weeks[g.week] = [];
        weeks[g.week].push(g);
      });
      return weeks;
    }

    function renderWeeks(weeks) {
      const weekSelect = document.getElementById("weekSelect");
      weekSelect.innerHTML = "";
      Object.keys(weeks).sort((a, b) => a - b).forEach(week => {
        const option = document.createElement("option");
        option.value = week;
        option.textContent = `Week ${week}`;
        weekSelect.appendChild(option);
      });
    }

    function renderGames(games) {
      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML = "";
      games.forEach(g => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${g.game_date}</td>
          <td>${g.game_time}</td>
          <td>${g.home_org_name || "TBD"}</td>
          <td>${g.away_org_name || "TBD"}</td>
          <td>${g.field_name || "TBD"}</td>
          <td>${g.home_score ?? 0} - ${g.away_score ?? 0}</td>
        `;
        tbody.appendChild(row);
      });
    }

    async function init() {
      const games = await fetchGames(2025);
      const weeks = groupByWeek(games);
      renderWeeks(weeks);

      const weekSelect = document.getElementById("weekSelect");
      weekSelect.addEventListener("change", () => {
        renderGames(weeks[weekSelect.value]);
      });

      // Default to first week
      if (weekSelect.options.length > 0) {
        weekSelect.selectedIndex = 0;
        renderGames(weeks[weekSelect.value]);
      }
    }

    init();
  </script>
</body>
</html>
