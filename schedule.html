<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bloomingdale Bears Schedule</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #003366; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #003366; color: white; }
    select, button { margin-right: 10px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Bloomingdale Bears Schedule</h1>

  <label for="week">Select Week:</label>
  <select id="week"></select>

  <button id="showAll">Show All BGYFL Games</button>

  <table id="schedule">
    <thead>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Home Team</th>
        <th>Away Team</th>
        <th>Field</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = "https://taupe-meringue-d27509.netlify.app/.netlify/functions/proxy?url=";
    const GAMES_URL = "https://slhjx7xcc1.execute-api.us-east-2.amazonaws.com/prod/api/getGames";
    const TEAMS_URL = "https://slhjx7xcc1.execute-api.us-east-2.amazonaws.com/prod/api/getTeams?year=2025&organizationId=9";

    let teamsMap = {};

    async function fetchTeams() {
      const res = await fetch(API_BASE + encodeURIComponent(TEAMS_URL));
      const data = await res.json();
      data.teams.forEach(t => {
        teamsMap[t.id] = t.name;
      });
    }

    async function fetchGames(week) {
      const url = `${GAMES_URL}?year=2025&week=${week}`;
      const res = await fetch(API_BASE + encodeURIComponent(url));
      return await res.json();
    }

    function renderGames(games) {
      const tbody = document.querySelector("#schedule tbody");
      tbody.innerHTML = "";

      games.forEach(game => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${game.game_date || ""}</td>
          <td>${game.game_time || ""}</td>
          <td>${teamsMap[game.home_team_id] || "TBD"}</td>
          <td>${teamsMap[game.away_team_id] || "TBD"}</td>
          <td>${game.field || ""}</td>
          <td>${game.home_score ?? 0} - ${game.away_score ?? 0}</td>
        `;
        tbody.appendChild(row);
      });
    }

    async function init() {
      await fetchTeams();

      // Populate week dropdown (1â€“10 for now)
      const weekSelect = document.getElementById("week");
      for (let i = 1; i <= 10; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `Week ${i}`;
        weekSelect.appendChild(opt);
      }

      // Default to week 1
      loadWeek(1);

      weekSelect.addEventListener("change", e => {
        loadWeek(e.target.value);
      });

      document.getElementById("showAll").addEventListener("click", () => {
        loadWeek(weekSelect.value);
      });
    }

    async function loadWeek(week) {
      const data = await fetchGames(week);
      renderGames(data.games || []);
    }

    init();
  </script>
</body>
</html>
