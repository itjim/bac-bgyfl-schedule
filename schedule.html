<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bloomingdale Bears Schedule</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #003366; }
    .controls { margin-bottom: 15px; }
    select, button { margin-right: 10px; padding: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #003366; color: white; }
    .bloomingdale { background-color: #ffeb99; }
  </style>
</head>
<body>
  <h1>Bloomingdale Bears Schedule</h1>
  <div class="controls">
    <label for="weekSelect">Select Week:</label>
    <select id="weekSelect"></select>

    <label for="teamSelect">Select Team:</label>
    <select id="teamSelect"></select>

    <button id="showAll">Show All BGYFL Games</button>
  </div>
  <table id="scheduleTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Home Team</th>
        <th>Away Team</th>
        <th>Field</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const proxy = "https://taupe-meringue-d27509.netlify.app/.netlify/functions/proxy?url=";

    const gamesApi = "https://slhjx7xcc1.execute-api.us-east-2.amazonaws.com/prod/api/getGames?year=2025&organizationId=9";
    const teamsApi = "https://slhjx7xcc1.execute-api.us-east-2.amazonaws.com/prod/api/getTeams?year=2025&organizationId=9";

    const gamesUrl = proxy + encodeURIComponent(gamesApi);
    const teamsUrl = proxy + encodeURIComponent(teamsApi);

    let allGames = [];
    let bloomTeams = [];
    let showingAll = false;

    async function fetchData() {
      try {
        const teamsRes = await fetch(teamsUrl);
        const teamsData = await teamsRes.json();
        bloomTeams = teamsData.teams.map(t => t.name);

        const gamesRes = await fetch(gamesUrl);
        const gamesData = await gamesRes.json();
        allGames = gamesData.games;

        populateWeekDropdown();
        populateTeamDropdown();
        renderSchedule();
      } catch (err) {
        console.error("Error fetching data:", err);
      }
    }

    function populateWeekDropdown() {
      const weekSelect = document.getElementById("weekSelect");
      const weeks = [...new Set(allGames.map(g => g.week))];
      weeks.sort((a, b) => a - b);

      weekSelect.innerHTML = "";
      weeks.forEach(week => {
        const sampleGame = allGames.find(g => g.week === week);
        const date = new Date(sampleGame.game_date);
        const label = `Week ${week} â€“ ${date.toLocaleDateString()}`;
        const option = new Option(label, week);
        weekSelect.add(option);
      });
    }

    function populateTeamDropdown() {
      const teamSelect = document.getElementById("teamSelect");
      teamSelect.innerHTML = "";
      bloomTeams.forEach(t => {
        const option = new Option(t, t);
        teamSelect.add(option);
      });
      teamSelect.add(new Option("All Bloomingdale Teams", "all"));
    }

    function renderSchedule() {
      const week = document.getElementById("weekSelect").value;
      const team = document.getElementById("teamSelect").value;
      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML = "";

      let filtered = allGames.filter(g => g.week == week);

      if (!showingAll) {
        if (team !== "all") {
          filtered = filtered.filter(g =>
            g.home_team === team || g.away_team === team
          );
        } else {
          filtered = filtered.filter(g =>
            bloomTeams.includes(g.home_team) ||
            bloomTeams.includes(g.away_team)
          );
        }
      }

      filtered.forEach(g => {
        const tr = document.createElement("tr");
        const date = new Date(g.game_date).toLocaleDateString();

        let scoreDisplay = "";
        if (g.home_score !== null && g.away_score !== null) {
          scoreDisplay = `${g.home_score} - ${g.away_score}`;
        }

        tr.innerHTML = `
          <td>${date}</td>
          <td>${g.game_time || ""}</td>
          <td class="${bloomTeams.includes(g.home_team) ? 'bloomingdale' : ''}">${g.home_team}</td>
          <td class="${bloomTeams.includes(g.away_team) ? 'bloomingdale' : ''}">${g.away_team}</td>
          <td>${g.field_name || ''}</td>
          <td>${scoreDisplay}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("weekSelect").addEventListener("change", renderSchedule);
    document.getElementById("teamSelect").addEventListener("change", renderSchedule);
    document.getElementById("showAll").addEventListener("click", () => {
      showingAll = !showingAll;
      document.getElementById("showAll").innerText = showingAll ? "Show Bloomingdale Only" : "Show All BGYFL Games";
      renderSchedule();
    });

    fetchData();
  </script>
</body>
</html>
